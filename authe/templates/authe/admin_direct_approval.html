{% extends 'main/base_unified.html' %}\n{% load static %}\n\n{% block title %}Admin Direct Approval - SAT-SHINE{% endblock %}\n\n{% block extra_css %}\n<style>\n    .approval-card {\n        border: 1px solid #e3e6f0;\n        border-radius: 0.35rem;\n        margin-bottom: 1rem;\n    }\n    .status-badge {\n        font-size: 0.75rem;\n        padding: 0.25rem 0.5rem;\n    }\n    .btn-approve {\n        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n        border: none;\n        color: white;\n    }\n    .btn-approve:hover {\n        background: linear-gradient(135deg, #218838 0%, #1ea085 100%);\n        color: white;\n    }\n</style>\n{% endblock %}\n\n{% block content %}\n<div class=\"container-fluid\">\n    <!-- Header -->\n    <div class=\"d-sm-flex align-items-center justify-content-between mb-4\">\n        <h1 class=\"h3 mb-0 text-gray-800\">\n            <i class=\"fas fa-user-check text-primary\"></i> Admin Direct Approval\n        </h1>\n        <div class=\"d-flex gap-2\">\n            <input type=\"date\" id=\"dateFilter\" class=\"form-control\" value=\"{{ selected_date|date:'Y-m-d' }}\" style=\"width: auto;\">\n            <button class=\"btn btn-primary\" onclick=\"filterByDate()\">\n                <i class=\"fas fa-filter\"></i> Filter\n            </button>\n        </div>\n    </div>\n\n    <!-- Info Alert -->\n    <div class=\"alert alert-info\">\n        <i class=\"fas fa-info-circle\"></i>\n        <strong>Admin Direct Approval for DC Users:</strong> 
        <ul class="mb-0 mt-2">
            <li><strong>MT/Support:</strong> DC confirms → Admin approves (2-step process)</li>
            <li><strong>Associate:</strong> Admin directly approves (1-step process)</li>
            <li><strong>DC:</strong> Admin directly approves (1-step process) ← This page</li>
        </ul>
        This allows you to directly approve DC attendance, bypassing the normal DC confirmation step since DCs cannot confirm their own attendance.\n    </div>\n\n    <!-- DC Attendance Records -->\n    <div class=\"card shadow mb-4\">\n        <div class=\"card-header py-3 d-flex justify-content-between align-items-center\">\n            <h6 class=\"m-0 font-weight-bold text-primary\">\n                DC Attendance Records - {{ selected_date|date:'d M Y' }}\n            </h6>\n            <span class=\"badge badge-secondary\">{{ attendance_records.count }} Records</span>\n        </div>\n        <div class=\"card-body\">\n            {% if attendance_records %}\n                <form method=\"post\" id=\"approvalForm\">\n                    {% csrf_token %}\n                    <input type=\"hidden\" name=\"action\" value=\"approve_direct\">\n                    \n                    <div class=\"table-responsive\">\n                        <table class=\"table table-bordered table-hover\">\n                            <thead class=\"thead-light\">\n                                <tr>\n                                    <th width=\"50\">\n                                        <input type=\"checkbox\" id=\"selectAll\" class=\"form-check-input\">\n                                    </th>\n                                    <th>Employee ID</th>\n                                    <th>Name</th>\n                                    <th>DCCB</th>\n                                    <th>Status</th>\n                                    <th>Check-In Time</th>\n                                    <th>Current Approval Status</th>\n                                    <th>Actions</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {% for attendance in attendance_records %}\n                                <tr>\n                                    <td>\n                                        <input type=\"checkbox\" name=\"attendance_ids\" value=\"{{ attendance.id }}\" class=\"form-check-input attendance-checkbox\">\n                                    </td>\n                                    <td><strong>{{ attendance.user.employee_id }}</strong></td>\n                                    <td>{{ attendance.user.first_name }} {{ attendance.user.last_name }}</td>\n                                    <td>\n                                        <span class=\"badge badge-info\">{{ attendance.user.dccb }}</span>\n                                    </td>\n                                    <td>\n                                        {% if attendance.status == 'present' %}\n                                            <span class=\"badge badge-success\">Present</span>\n                                        {% elif attendance.status == 'absent' %}\n                                            <span class=\"badge badge-danger\">Absent</span>\n                                        {% elif attendance.status == 'half_day' %}\n                                            <span class=\"badge badge-warning\">Half Day</span>\n                                        {% else %}\n                                            <span class=\"badge badge-secondary\">{{ attendance.status|title }}</span>\n                                        {% endif %}\n                                    </td>\n                                    <td>\n                                        {% if attendance.check_in_time %}\n                                            {{ attendance.check_in_time|time:'H:i' }}\n                                            {% if attendance.check_in_time > '09:30:00'|time %}\n                                                <span class=\"badge badge-warning badge-sm ml-1\">Late</span>\n                                            {% endif %}\n                                        {% else %}\n                                            <span class=\"text-muted\">Not Marked</span>\n                                        {% endif %}\n                                    </td>\n                                    <td>\n                                        <div class=\"d-flex flex-column gap-1\">\n                                            {% if attendance.is_confirmed_by_dc %}\n                                                <span class=\"badge badge-success badge-sm\">DC Confirmed</span>\n                                            {% else %}\n                                                <span class=\"badge badge-warning badge-sm\">DC Pending</span>\n                                            {% endif %}\n                                            \n                                            {% if attendance.is_approved_by_admin %}\n                                                <span class=\"badge badge-success badge-sm\">Admin Approved</span>\n                                            {% else %}\n                                                <span class=\"badge badge-secondary badge-sm\">Admin Pending</span>\n                                            {% endif %}\n                                        </div>\n                                    </td>\n                                    <td>\n                                        {% if not attendance.is_approved_by_admin %}\n                                            <button type=\"button\" class=\"btn btn-sm btn-success\" onclick=\"approveIndividual({{ attendance.id }})\">\n                                                <i class=\"fas fa-check\"></i> Direct Approve\n                                            </button>\n                                        {% else %}\n                                            <span class=\"text-success\">\n                                                <i class=\"fas fa-check-circle\"></i> Approved\n                                            </span>\n                                        {% endif %}\n                                    </td>\n                                </tr>\n                                {% endfor %}\n                            </tbody>\n                        </table>\n                    </div>\n                    \n                    <!-- Bulk Actions -->\n                    <div class=\"mt-3 d-flex justify-content-between align-items-center\">\n                        <div>\n                            <span id=\"selectedCount\" class=\"text-muted\">0 records selected</span>\n                        </div>\n                        <div>\n                            <button type=\"submit\" class=\"btn btn-approve\" id=\"bulkApproveBtn\" disabled>\n                                <i class=\"fas fa-check-double\"></i> Bulk Direct Approve\n                            </button>\n                        </div>\n                    </div>\n                </form>\n            {% else %}\n                <div class=\"text-center py-4\">\n                    <i class=\"fas fa-calendar-times fa-3x text-muted mb-3\"></i>\n                    <h5 class=\"text-muted\">No DC attendance records found</h5>\n                    <p class=\"text-muted\">No DC users have attendance records for {{ selected_date|date:'d M Y' }}</p>\n                </div>\n            {% endif %}\n        </div>\n    </div>\n</div>\n\n<script>\n// Date filter functionality\nfunction filterByDate() {\n    const selectedDate = document.getElementById('dateFilter').value;\n    if (selectedDate) {\n        window.location.href = `?date=${selectedDate}`;\n    }\n}\n\n// Select all functionality\ndocument.getElementById('selectAll').addEventListener('change', function() {\n    const checkboxes = document.querySelectorAll('.attendance-checkbox');\n    checkboxes.forEach(checkbox => {\n        checkbox.checked = this.checked;\n    });\n    updateSelectedCount();\n});\n\n// Individual checkbox change\ndocument.querySelectorAll('.attendance-checkbox').forEach(checkbox => {\n    checkbox.addEventListener('change', updateSelectedCount);\n});\n\n// Update selected count and enable/disable bulk button\nfunction updateSelectedCount() {\n    const selectedCheckboxes = document.querySelectorAll('.attendance-checkbox:checked');\n    const count = selectedCheckboxes.length;\n    \n    document.getElementById('selectedCount').textContent = `${count} records selected`;\n    document.getElementById('bulkApproveBtn').disabled = count === 0;\n    \n    // Update select all checkbox state\n    const allCheckboxes = document.querySelectorAll('.attendance-checkbox');\n    const selectAllCheckbox = document.getElementById('selectAll');\n    \n    if (count === 0) {\n        selectAllCheckbox.indeterminate = false;\n        selectAllCheckbox.checked = false;\n    } else if (count === allCheckboxes.length) {\n        selectAllCheckbox.indeterminate = false;\n        selectAllCheckbox.checked = true;\n    } else {\n        selectAllCheckbox.indeterminate = true;\n    }\n}\n\n// Individual approval\nfunction approveIndividual(attendanceId) {\n    if (confirm('Are you sure you want to directly approve this DC attendance? This will bypass DC confirmation.')) {\n        // Create a temporary form for individual approval\n        const form = document.createElement('form');\n        form.method = 'POST';\n        form.innerHTML = `\n            {% csrf_token %}\n            <input type=\"hidden\" name=\"action\" value=\"approve_direct\">\n            <input type=\"hidden\" name=\"attendance_ids\" value=\"${attendanceId}\">\n        `;\n        document.body.appendChild(form);\n        form.submit();\n    }\n}\n\n// Form submission confirmation\ndocument.getElementById('approvalForm').addEventListener('submit', function(e) {\n    const selectedCount = document.querySelectorAll('.attendance-checkbox:checked').length;\n    if (selectedCount === 0) {\n        e.preventDefault();\n        alert('Please select at least one attendance record to approve.');\n        return;\n    }\n    \n    if (!confirm(`Are you sure you want to directly approve ${selectedCount} DC attendance records? This will bypass DC confirmation and reflect in their attendance history.`)) {\n        e.preventDefault();\n    }\n});\n\n// Initialize\nupdateSelectedCount();\n</script>\n{% endblock %}